/*!
 * TableExport.js v4.0.0-beta (http://www.clarketravis.com)
 * Copyright 2016 Travis Clarke
 * Licensed under the MIT license
 */
!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","node-safe-filesaver","xlsx"],function(e,n,o){return t(window,e,n.saveAs,o.XLSX)}):"undefined"!=typeof exports?module.exports=t(window,require("jquery"),require("node-safe-filesaver").saveAs,require("xlsx").XLSX):t(window,window.jQuery,window.saveAs,window.XLSX)}(function(t,e,n,o){"use strict";var i=function(t,n,o){var s=this;s.settings=o?n:e.extend({},i.prototype.defaults,n),s.selectors=t;var r,a,f,p=i.prototype.rowDel,l=s.settings.ignoreRows instanceof Array?s.settings.ignoreRows:[s.settings.ignoreRows],u=s.settings.ignoreCols instanceof Array?s.settings.ignoreCols:[s.settings.ignoreCols],c=s.settings.ignoreCSS instanceof Array?s.settings.ignoreCSS.join(", "):s.settings.ignoreCSS;return s.settings.bootstrap?(r=i.prototype.bootstrap[0]+" ",a=i.prototype.bootstrap[1]+" ",f=i.prototype.bootstrap[2]+" "):(r=i.prototype.defaultButton+" ",a=f=""),s.selectors.each(function(){function t(t){var e=d.find("caption:not(.head)");e.length?e.append(t):d.prepend('<caption class="'+f+s.settings.position+'">'+t+"</caption>")}function n(e,n,o){var i="<button data-fileblob='"+e+"' class='"+r+a+o+"'>"+n+"</button>";t(i)}var d=e(this);o&&d.find("caption:not(.head)").remove();var x=d.find("tbody").find("tr"),x=s.settings.headings?x.add(d.find("thead>tr")):x,x=s.settings.footers?x.add(d.find("tfoot>tr")):x,y=s.settings.headings?d.find("thead>tr").length:0,m="id"===s.settings.fileName?d.attr("id")?d.attr("id"):i.prototype.defaultFileName:s.settings.fileName,g={xlsx:function(t,o){var s=x.map(function(t,n){if(!~l.indexOf(t-y)&&!e(n).is(c)){var o=e(n).find("th, td");return[o.map(function(t,n){if(!~u.indexOf(t)&&!e(n).is(c))return e(n).text()}).get()]}}).get(),r=i.prototype.escapeHtml(JSON.stringify({data:s,fileName:o,mimeType:i.prototype.xlsx.mimeType,fileExtension:i.prototype.xlsx.fileExtension})),a=i.prototype.xlsx.buttonContent,f=i.prototype.xlsx.defaultClass;n(r,a,f)},xls:function(t,o){var s=i.prototype.xls.separator,r=x.map(function(t,n){if(!~l.indexOf(t-y)&&!e(n).is(c)){var o=e(n).find("th, td");return o.map(function(t,n){if(!~u.indexOf(t)&&!e(n).is(c))return e(n).text()}).get().join(s)}}).get().join(t),a=i.prototype.escapeHtml(JSON.stringify({data:r,fileName:o,mimeType:i.prototype.xls.mimeType,fileExtension:i.prototype.xls.fileExtension})),f=i.prototype.xls.buttonContent,p=i.prototype.xls.defaultClass;n(a,f,p)},csv:function(t,o){var s=i.prototype.csv.separator,r=x.map(function(t,n){if(!~l.indexOf(t-y)&&!e(n).is(c)){var o=e(n).find("th, td");return o.map(function(t,n){if(!~u.indexOf(t)&&!e(n).is(c))return e(n).text()}).get().join(s)}}).get().join(t),a=i.prototype.escapeHtml(JSON.stringify({data:r,fileName:o,mimeType:i.prototype.csv.mimeType,fileExtension:i.prototype.csv.fileExtension})),f=i.prototype.csv.buttonContent,p=i.prototype.csv.defaultClass;n(a,f,p)},txt:function(t,o){var s=i.prototype.txt.separator,r=x.map(function(t,n){if(!~l.indexOf(t-y)&&!e(n).is(c)){var o=e(n).find("th, td");return o.map(function(t,n){if(!~u.indexOf(t)&&!e(n).is(c))return e(n).text()}).get().join(s)}}).get().join(t),a=i.prototype.escapeHtml(JSON.stringify({data:r,fileName:o,mimeType:i.prototype.txt.mimeType,fileExtension:i.prototype.txt.fileExtension})),f=i.prototype.txt.buttonContent,p=i.prototype.txt.defaultClass;n(a,f,p)}};s.settings.formats.forEach(function(t){g[t](p,m)})}),e("button[data-fileblob]").off("click").on("click",function(){var t=e(this).data("fileblob"),n=t.data,o=t.fileName,s=t.mimeType,r=t.fileExtension;i.prototype.export2file(n,s,o,r)}),s};i.prototype={defaults:{headings:!0,footers:!0,formats:["xls","csv","txt"],fileName:"id",bootstrap:!0,position:"bottom",ignoreRows:null,ignoreCols:null,ignoreCSS:".tableexport-ignore"},charset:"charset=utf-8",defaultFileName:"myDownload",defaultButton:"button-default",bootstrap:["btn","btn-default","btn-toolbar"],rowDel:"\r\n",entityMap:{"&":"&#38;","<":"&#60;",">":"&#62;","'":"&#39;","/":"&#47"},xlsx:{defaultClass:"xlsx",buttonContent:"Export to xlsx",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",fileExtension:".xlsx"},xls:{defaultClass:"xls",buttonContent:"Export to xls",separator:"\t",mimeType:"application/vnd.ms-excel",fileExtension:".xls"},csv:{defaultClass:"csv",buttonContent:"Export to csv",separator:",",mimeType:"application/csv",fileExtension:".csv"},txt:{defaultClass:"txt",buttonContent:"Export to txt",separator:"  ",mimeType:"text/plain",fileExtension:".txt"},escapeHtml:function(t){return String(t).replace(/[&<>'\/]/g,function(t){return i.prototype.entityMap[t]})},dateNum:function(t,e){e&&(t+=1462);var n=Date.parse(t);return(n-new Date(Date.UTC(1899,11,30)))/864e5},createSheet:function(t){for(var e={},n={s:{c:1e7,r:1e7},e:{c:0,r:0}},i=0;i!=t.length;++i)for(var s=0;s!=t[i].length;++s){n.s.r>i&&(n.s.r=i),n.s.c>s&&(n.s.c=s),n.e.r<i&&(n.e.r=i),n.e.c<s&&(n.e.c=s);var r={v:t[i][s]};if(null!=r.v){var a=o.utils.encode_cell({c:s,r:i});"number"==typeof r.v?r.t="n":"boolean"==typeof r.v?r.t="b":r.v instanceof Date?(r.t="n",r.z=o.SSF._table[14],r.v=this.dateNum(r.v)):r.t="s",e[a]=r}}return n.s.c<1e7&&(e["!ref"]=o.utils.encode_range(n)),e},Workbook:function(){this.SheetNames=[],this.Sheets={}},string2ArrayBuffer:function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),o=0;o!=t.length;++o)n[o]=255&t.charCodeAt(o);return e},export2file:function(t,e,i,s){if(".xlsx"===s){var r=new this.Workbook,a=this.createSheet(t);r.SheetNames.push(i),r.Sheets[i]=a;var f={bookType:"xlsx",bookSST:!1,type:"binary"},p=o.write(r,f);t=this.string2ArrayBuffer(p)}n(new Blob([t],{type:e+";"+this.charset}),i+s)},update:function(t){return new i(this.selectors,e.extend({},this.settings,t),(!0))},reset:function(){return new i(this.selectors,settings,(!0))},remove:function(){this.selectors.each(function(){e(this).find("caption:not(.head)").remove()})}},e.fn.tableExport=function(t,e){return new i(this,t,e)}});